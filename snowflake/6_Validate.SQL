USE DATABASE RETAIL_DEMO_DB;


-- straring streaming pipeline

ALTER TASK RETAIL_DEMO_DB.SILVER.RETAIL_SALES_DAILY_SUMMARY_TASK RESUME;
ALTER TASK RETAIL_DEMO_DB.SILVER.UPDATE_INVENTORY_TASK RESUME; 
ALTER TASK RETAIL_DEMO_DB.SILVER.INVENTORY_INSERT_TASK RESUME; 
ALTER TASK RETAIL_DEMO_DB.SILVER.PROCESS_RETAIL_POS_RAW_TASK RESUME;


-- stopping streaming pipeline

-- ALTER TASK RETAIL_DEMO_DB.SILVER.RETAIL_SALES_DAILY_SUMMARY_TASK SUSPEND;
-- ALTER TASK RETAIL_DEMO_DB.SILVER.UPDATE_INVENTORY_TASK SUSPEND; 
-- ALTER TASK RETAIL_DEMO_DB.SILVER.INVENTORY_INSERT_TASK SUSPEND; 
-- ALTER TASK RETAIL_DEMO_DB.SILVER.PROCESS_RETAIL_POS_RAW_TASK SUSPEND;


-- Truncating streams

TRUNCATE RETAIL_DEMO_DB.BRONZE.RETAIL_POS_RAW;
TRUNCATE RETAIL_DEMO_DB.SILVER.RETAIL_POS_PROCESSED;
TRUNCATE RETAIL_DEMO_DB.SILVER.INVENTORY;
TRUNCATE RETAIL_DEMO_DB.GOLD.RETAIL_SALES_DAILY_SUMMARY;




SELECT 'BRONZE.RETAIL_RAW_POS' AS table_name, COUNT(*) AS row_count 
FROM RETAIL_DEMO_DB.BRONZE.RETAIL_RAW_POS
UNION ALL
SELECT 'SILVER.RETAIL_POS_PROCESSED', COUNT(*) 
FROM RETAIL_DEMO_DB.SILVER.RETAIL_POS_PROCESSED
UNION ALL
SELECT 'SILVER.INVENTORY', COUNT(*) 
FROM RETAIL_DEMO_DB.SILVER.INVENTORY
UNION ALL
SELECT 'GOLD.RETAIL_SALES_DAILY_SUMMARY', COUNT(*) 
FROM RETAIL_DEMO_DB.GOLD.RETAIL_SALES_DAILY_SUMMARY;



-- select * from retail_analytics_db.silver.retail_pos_processed WHERE timestamp >= DATEADD(minute, -5, CURRENT_TIMESTAMP())
-- select * from retail_analytics_db.silver.retail_pos_processed WHERE TRANSACTION_ID='txn_10590'

-- select * from retail_analytics_db.silver.retail_pos_processed_stream_1
-- select * from retail_analytics_db.silver.retail_pos_processed_stream_2
-- select * from retail_analytics_db.silver.dim_store

-- select * from retail_analytics_db.silver.inventory


